---
title: "Scrap deaths of characters in GoT"
output: html_notebook
---


```{r warning=FALSE, message=FALSE}

library(rebus)
library(stringr)
library(rvest)
library(magrittr)
library(tidyverse)

```

```{r warning=FALSE, message=FALSE}

if(!"interim_output" %in% list.files()){
  
  dir.create("interim_output")
  
}

```

Scrap web data of character deaths
```{r warning=FALSE, message=FALSE}

if(!"death.web.RDS" %in% list.files("interim_output") ){

death.web <- html("https://genius.com/Screen-genius-list-of-game-of-thrones-deaths-annotated")

saveRDS(death.web, "interim_output/death.web.RDS")

} else{
  
  death.web <- readRDS("interim_output/death.web.RDS")
  
}

```

```{r warning=FALSE, message=FALSE}

death.list <- list()

nodes.df <- data_frame(nodes = c(4,6,8,10,12,14,16),
                       season = str_c("season", 1:7, sep = "_"))

for (i in 1:nrow(nodes.df)){

death.list [[nodes.df[[i,"season"]]]] <- death.web %>% 
  html_node(str_c("p:nth-child(",nodes.df[i,"nodes"], ")", sep = "") ) %>%
  html_text() %>%
  str_split(pattern = "Episode " ) %>% 
  unlist() %>%
  .[2:length(.)]
  
}

```

```{r warning=FALSE, message=FALSE}

death.list %<>% 
  map(function(x) {str_split(x, pattern = "\n.", simplify = T) %>%
  as_data_frame() %>%
  map_df(function(o){str_replace(o, pattern = "\\n", replacement = "")}) })

death.list
  
```

One way of doing it 

```{r warning=FALSE, message=FALSE}

season.one <- death.web %>% 
  html_node("p:nth-child(4)") %>%
  html_text() %>%
  str_split(pattern = "Episode " ) %>% 
  unlist() %>%
  .[2:length(.)]

season.two <- death.web %>% 
  html_node("p:nth-child(6)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

season.three <- death.web %>% 
  html_node("p:nth-child(8)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

season.four <- death.web %>% 
  html_node("p:nth-child(10)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

season.five <- death.web %>% 
  html_node("p:nth-child(12)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

season.six <- death.web %>% 
  html_node("p:nth-child(14)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

season.seven <- death.web %>% 
  html_node("p:nth-child(16)") %>%
  html_text() %>%
  str_split(pattern = "Episode ") %>% 
  unlist() %>%
  .[2:length(.)]

```

```{r warning=FALSE, message=FALSE}

season.one <- str_split(season.one, pattern = "\n.", simplify = T) %>%
  as_data_frame() %>%
  map_df(function(x){str_replace(x, pattern = "\\n", replacement = "")})

season.one %<>%
  separate(`V1`, into = c("episode_number", "episode_name"), sep = ":", remove = T) 

season.one[["episode_name"]] %<>%
  str_replace_all(pattern = optional(" ") %R% "\"", replacement = "")

```







